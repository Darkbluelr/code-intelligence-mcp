1) **结论（第 1 次 Challenge，`<truth-root>`=`dev-playbooks/specs`，`<change-root>`=`dev-playbooks/changes`）**：`Revise` —— 提案的 A/B（版本/配置/AI 双代理）边界、`metrics.json`/对比报告契约、以及“复杂/简单”场景的可验证性尚未闭合，按现状推进容易得到“可跑但不可复用/不可对比/不可审计”的演示资产。

2) **阻断项（Blocking）**

- **写入边界未闭合，且与当前仓库事实冲突**：提案要求“所有最终产物只写入显式 out-dir，/tmp 仅允许中间产物且不得作为最终归档”，但当前 demo 已存在明确违例点：
  - `demo/05-performance.sh:6` 硬编码写入 `dev-playbooks/changes/20260122-verify-metrics/evidence`（proposal 已指出），这会把输出写入错误 change-id。
  - `demo/04-quality.sh:15` 写入 `/tmp/ci-drift-snapshot.json`，且没有清理；若 demo-suite 追求“无散落文件”，需要明确是否允许残留 `/tmp` 文件、以及如何保证清理与隔离。
  - 结论：必须在 proposal 里把“允许的临时目录策略 / 清理策略 / 如何证明不越界写入”写清楚，否则 AC-002 难以验真。

- **A/B（版本 A/B）边界不够可执行**：提案写“git ref A vs git ref B”，但缺少可验证的运行语义：
  - A/B 的输入形式是什么（commit hash / tag / branch）？是否允许 dirty working tree？
  - 运行时如何做到“同一数据集、同一环境”的可复现（Node 版本、依赖安装状态、`.devbooks/` 缓存/索引状态）？
  - 是否采用 `git worktree`/临时 clone 来并行或顺序运行？若直接 checkout，会对当前工作区造成副作用，且对“证据落盘”不友好。
  - 结论：没有这些边界定义，版本 A/B 无法成为可靠的自动化演示与回归证据。

- **A/B（配置 A/B）边界不够可执行**：提案写“有/无上下文注入”“有/无预热/缓存”等，但当前系统中的“可控开关”与隔离策略未定义：
  - “上下文注入开关”具体作用于哪一层（仅 hook 输出展示，还是影响工具调用参数/输入）？如何保证 A/B 的唯一区别是该开关？
  - “预热/缓存”涉及哪些目录与文件（例如 `.devbooks/`、`cache/`），如何在 A/B 中做到隔离/清空/复用，并记录在 `metrics.json` 里？
  - 结论：缺少开关枚举、默认值、隔离/清理策略，配置 A/B 会变成“不可解释的噪声对比”。

- **A/B（AI 双代理）边界仍然模糊**：提案声明“只做半自动、契约 + 采集 + 对比”，但未定义：
  - “双代理”比较的对象是什么（两种模型/两种工具链/两种提示词策略/两次独立会话）？必须保持哪些变量一致（任务说明、时间预算、允许工具、起始代码状态）？
  - scorecard 的字段、评分规则、证据要求是什么（例如：是否必须附 `git diff`、命令记录、失败日志、耗时/轮次）？
  - 结论：如果不先把 scorecard 变成可审计的“对比契约”，AI 双代理 A/B 的结果很容易不可复用、不可解释、不可对比。

- **“复杂/简单”场景的可验证性不足**：提案要求在 `metrics.json` 中输出可比较字段（含 `has_expected_hit` 等），但未给出“期望命中”的真值来源：
  - `demo/02-diagnosis.sh` 里的 `ERROR_MSG="TypeError: Cannot read property 'user'"` 更像示例文本，不是仓库内可验证的真实 bug；若没有固定的期望命中目标（文件/符号/调用链片段/影响文件集合），`has_expected_hit` 无法判真伪。
  - “复杂 Bug”场景依赖 `ci_call_chain`/`ci_impact` 等工具输出；这些输出可能受可选依赖（如 CKB MCP）、索引状态影响。仅用 `has_call_chain=true`（非空）会变成“形式指标”，无法证明能力提升。
  - 结论：必须先定义场景的“固定输入 + 固定期望输出/命中锚点 + 允许的降级条件”，否则复杂/简单场景的指标对比没有科学意义。

- **验收闸门与可执行 AC 不闭合**：proposal 要求 demo 脚本通过 ShellCheck，但当前 `package.json` 的 `npm run lint` 仅覆盖 `scripts/*.sh hooks/*.sh`，不包含 `demo/*.sh`；同时 `npm test` 目前为 “No tests yet”。
  - 结论：若不把 demo-suite 的质量闸门（ShellCheck/构建/可运行性）写成明确可跑的命令与证据落点，AC-001~AC-005 的“可执行验收方向”会停留在口头层面。

- **设计文档缺失导致边界不可审查**：变更包内 `dev-playbooks/changes/20260123-0702-improve-demo-suite-ab-metrics/design.md` 仍是模板骨架，关键部分（边界、契约、兼容策略、AC）未成文。
  - 结论：在引入“演示产物契约 + 对比机制 + 归档结构”的情况下，缺少最小设计会显著增加实现漂移与返工风险；建议先补齐设计再进入 tasks/实现。

3) **遗漏项（Missing）**

- **需要补充/细化的 AC（建议新增 AC-006 起）**
  - AC-006（契约可验证）：明确 `metrics.json` 的最小必填字段、可选字段、缺失/降级时的表示法（例如 `null`/缺字段/`degraded=true` + `reasons[]`），并给出“如何验证契约”的命令（例如基于 `jq`/JSON Schema 的校验）与证据落点。
  - AC-007（对比逻辑可解释）：明确 `compare.json/compare.md` 的输入输出、阈值配置位置、每个指标的方向（higher-is-better/lower-is-better）、容忍区间与判定规则；并要求对“字段缺失/降级”的对比行为有定义（跳过/标红/降级结论）。
  - AC-008（版本 A/B 可运行）：明确一个可执行的命令接口（示例即可）来运行 `--ref-a/--ref-b`，并要求输出目录结构可追溯到两个 ref（如写入 `git_ref`、记录 `git describe`、记录 dirty 状态）。
  - AC-009（配置 A/B 可运行）：枚举至少 2 个可控开关（例如“上下文注入 on/off”“预热 on/off”），定义默认值与隔离策略，并要求 compare 报告能指出“差异来自哪个开关”。
  - AC-010（写入边界可证明）：提供一个可复现的检查方式来证明“最终产物只在 out-dir 下”，并定义 `/tmp` 是否允许、若允许则必须清理（或将临时文件写到 out-dir 内）。
  - AC-011（复杂/简单场景可判真）：为两个场景分别定义“固定输入 + 期望命中锚点 + 允许降级条件”；若使用 `has_expected_hit`，必须明确 expected 的来源与维护策略（随版本更新如何调整）。
  - AC-012（AI 双代理 scorecard 契约）：定义 scorecard 的字段、评分与证据要求（至少包含：任务定义、起始 git_ref、输出 diff/命令记录、时间/轮次、是否通过某个验证锚点），并明确“如何把两次会话沉淀为可比对产物”。

- **需要补充的“证据落点”清单（不仅是路径）**
  - 至少一组“成功运行”的证据：`run-a/metrics.json + run-a/report.md`（含 raw/ 可选）以及对应的 `compare.json + compare.md`。
  - 至少一组“降级运行”的证据：缺少可选依赖（如无 `jq`/无 CKB MCP）时仍能产出 `metrics.json/report.md`，并在 report 中清楚标注降级原因与缺失项。
  - 若要声称“耗时指标可对比”，建议至少记录重复运行次数与波动范围（例如 3 次运行取中位/或记录 min/median/max），否则阈值判定缺乏可信度。

- **需要补充的“可复现性元信息”**
  - 数据集指纹：`queries.jsonl` 的路径 + 行数 + hash（避免不同 ref 下 queries 内容变化导致假对比）。
  - 运行环境快照：Node/OS/CPU、`rg`/`jq` 版本、是否启用某些 features（例如 `config/features.yaml` 的关键开关）。
  - 缓存/索引状态：`.devbooks/` 相关缓存是否存在、是否预热、是否清空（至少记录策略与结果）。

- **与背景文档的对齐缺口**
  - `dev-playbooks/docs/长期可复用演示方案.md` 里涉及的脚本/路径（例如 hooks 名称、demo 入口）需要与当前仓库事实和本变更新增入口对齐，否则“落地”为名、实际无法照文档复现。

4) **非阻断项（Non-blocking）**

- `demo/DEMO-GUIDE.md` 当前为英文且存在重复段落；若本变更希望“长期复用 + 对外展示”，建议顺手做一次去重与中英一致性整理（不影响核心闭环，但能显著降低演示认知成本）。
- `docs/demos/` 若进入版本库，建议明确体积预算与清理机制（例如只允许 JSON/MD，小文件上限），避免“归档膨胀”从风险停留在口头。

5) **替代方案**

- **范围收缩（更稳）**：先只做“写入边界修复 + 单次运行标准产物（metrics/report）+ 性能维度对比（复用 `scripts/benchmark.sh --compare`）”，把“配置 A/B + AI 双代理 A/B + 全维度 runner”推迟到下一次变更；这样更容易在短期内形成可验证闭环。
- **可验证场景优先**：若“复杂/简单”场景目前缺乏真值锚点，先引入一个专用的 demo fixture（独立目录或固定外部仓库）来提供稳定的 expected，再谈 `has_expected_hit` 与能力对比；避免用不可判真的示例文本做指标。

6) **风险与证据缺口**

- **噪声与误判风险**：耗时指标易受机器负载、缓存命中、索引状态影响；若 compare 直接给“回归/提升”结论但没有重复运行与波动记录，会显著降低可信度。
- **对比输入不一致风险**：版本 A/B 若在不同 ref 上使用不同 queries/不同依赖版本/不同缓存状态，会导致“对比结论不可解释”；必须用数据指纹与环境快照把可解释性锁住。
- **证据缺口（当前 proposal 未覆盖）**：缺少对“降级路径仍可产出契约文件”“写入边界可证明”“复杂/简单场景有真值锚点”的可执行验证步骤；建议把这些补为明确 AC 与 evidence 树结构要求后再进入实现阶段。
