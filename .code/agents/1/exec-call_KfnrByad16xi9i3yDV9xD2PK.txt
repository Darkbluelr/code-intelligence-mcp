ls: invalid option -- á
usage: ls [-@ABCFGHILOPRSTUWXabcdefghiklmnopqrstuvwxy1%,] [--color=when] [-D format] [file ...]
total 16
drwxr-xr-x   3 ozbombor  staff    96 Jan 15 22:52 .
drwxr-xr-x  57 ozbombor  staff  1824 Jan 18 05:51 ..
-rw-r--r--   1 ozbombor  staff  5564 Jan 15 22:52 spec.md
# è§„æ ¼ï¼šSCIP è§£æžè½¬æ¢ï¼ˆscip-parserï¼‰

> **Change ID**: `augment-parity`
> **Capability**: scip-parser
> **Version**: 1.0.0
> **Status**: Draft
> **Created**: 2026-01-15

---

## Requirementsï¼ˆéœ€æ±‚ï¼‰

### REQ-SP-001ï¼šSCIP ç´¢å¼•è§£æž

ç³»ç»Ÿåº”èƒ½è§£æž SCIP protobuf æ ¼å¼çš„ç´¢å¼•æ–‡ä»¶ï¼Œæå–ç¬¦å·å’Œå¼•ç”¨ä¿¡æ¯ã€‚

**çº¦æŸ**ï¼š
- ä½¿ç”¨ protobufjs è§£æž SCIP æ ¼å¼
- é»˜è®¤ç´¢å¼•æ–‡ä»¶è·¯å¾„ï¼š`index.scip`
- æ”¯æŒé€šè¿‡çŽ¯å¢ƒå˜é‡ `SCIP_INDEX_PATH` æŒ‡å®šè·¯å¾„

### REQ-SP-002ï¼šç¬¦å·æå–

ç³»ç»Ÿåº”ä»Ž SCIP ç´¢å¼•ä¸­æå–ä»¥ä¸‹ç¬¦å·ä¿¡æ¯ï¼š

| æå–é¡¹ | SCIP æ•°æ®æ¥æº | è¯´æ˜Ž |
|--------|--------------|------|
| ç¬¦å· ID | `occurrence.symbol` | å”¯ä¸€æ ‡è¯† |
| ç¬¦å·åç§° | ä»Ž symbol è§£æž | æœ€åŽä¸€æ®µ |
| ç¬¦å·ç±»åž‹ | symbol å‰ç¼€ | function/class/variable ç­‰ |
| æ–‡ä»¶è·¯å¾„ | `document.relative_path` | ç›¸å¯¹é¡¹ç›®æ ¹ |
| è¡Œå·èŒƒå›´ | `occurrence.range` | [start_line, start_col, end_line, end_col] |

### REQ-SP-003ï¼šè¾¹ç±»åž‹æ˜ å°„

ç³»ç»Ÿåº”æ ¹æ® SCIP `symbol_roles` æ˜ å°„åˆ°å›¾è¾¹ç±»åž‹ï¼š

| symbol_roles å€¼ | è¾¹ç±»åž‹ | è¯´æ˜Ž |
|-----------------|--------|------|
| 1 (Definition) | DEFINES | å®šä¹‰å…³ç³» |
| 2 (Import) | IMPORTS | å¯¼å…¥å…³ç³» |
| 4 (WriteAccess) | MODIFIES | å†™å…¥/ä¿®æ”¹å…³ç³» |
| 8 (ReadAccess) | CALLS | è¯»å–/è°ƒç”¨å…³ç³» |

### REQ-SP-004ï¼šå›¾æ•°æ®å†™å…¥

ç³»ç»Ÿåº”å°†è§£æžç»“æžœå†™å…¥ SQLite å›¾å­˜å‚¨ï¼š

1. ä¸ºæ¯ä¸ªå®šä¹‰åˆ›å»ºèŠ‚ç‚¹
2. ä¸ºæ¯ä¸ªå¼•ç”¨åˆ›å»ºè¾¹ï¼ˆå®šä¹‰èŠ‚ç‚¹ â†’ å¼•ç”¨ä½ç½®ï¼‰
3. ä½¿ç”¨æ‰¹é‡å†™å…¥æé«˜æ•ˆçŽ‡

### REQ-SP-005ï¼šå¢žé‡æ›´æ–°

ç³»ç»Ÿåº”æ”¯æŒå¢žé‡æ›´æ–°ç­–ç•¥ï¼š

- æ£€æµ‹ SCIP ç´¢å¼•æ–‡ä»¶ mtime
- è‹¥ç´¢å¼•æ¯”æ•°æ®åº“æ–°ï¼Œæ‰§è¡Œæ›´æ–°
- æ›´æ–°æ—¶å…ˆæ¸…ç†å¯¹åº”æ–‡ä»¶çš„æ—§æ•°æ®

### REQ-SP-006ï¼šé™çº§ç­–ç•¥

å½“ SCIP è§£æžå¤±è´¥æ—¶ï¼Œç³»ç»Ÿåº”é™çº§åˆ°æ­£åˆ™åŒ¹é…ï¼š

| è¾¹ç±»åž‹ | é™çº§æ­£åˆ™æ¨¡å¼ |
|--------|-------------|
| CALLS | `\b(\w+)\s*\(` |
| IMPORTS | `import .* from ['"](.*)['"]` |
| DEFINES | `(function|class|const|let|var)\s+(\w+)` |

**çº¦æŸ**ï¼šé™çº§æ—¶è¾“å‡ºè­¦å‘Šæ—¥å¿—ï¼Œæ ‡è®°ç½®ä¿¡åº¦ä¸º "low"ã€‚

### REQ-SP-007ï¼šè§£æžç»Ÿè®¡

ç³»ç»Ÿåº”è¾“å‡ºè§£æžç»Ÿè®¡ä¿¡æ¯ï¼š

- è§£æžçš„æ–‡æ¡£æ•°
- æå–çš„ç¬¦å·æ•°
- æå–çš„å¼•ç”¨æ•°
- å„è¾¹ç±»åž‹æ•°é‡

---

## Scenariosï¼ˆåœºæ™¯ï¼‰

### SC-SP-001ï¼šæˆåŠŸè§£æž SCIP ç´¢å¼•

**Given**:
- å­˜åœ¨æœ‰æ•ˆçš„ `index.scip` æ–‡ä»¶ï¼ˆscip-typescript ç”Ÿæˆï¼‰
- å›¾æ•°æ®åº“å·²åˆå§‹åŒ–
**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
**Then**:
- è§£æžæˆåŠŸï¼Œæ— é”™è¯¯
- èŠ‚ç‚¹æ•° >= 187ï¼ˆå½“å‰é¡¹ç›®åŸºå‡†ï¼‰
- è¾¹æ•° >= 307ï¼ˆå½“å‰é¡¹ç›®åŸºå‡†ï¼‰
- è¾“å‡ºè§£æžç»Ÿè®¡ä¿¡æ¯

### SC-SP-002ï¼šè¾¹ç±»åž‹æ­£ç¡®æ˜ å°„

**Given**: SCIP ç´¢å¼•åŒ…å«ä»¥ä¸‹ occurrenceï¼š
```
symbol: "npm scip-typescript 0.4.0 src/`server.ts`/main()."
symbol_roles: 1 (Definition)
```
**When**: æ‰§è¡Œè§£æž
**Then**:
- åˆ›å»ºèŠ‚ç‚¹ï¼Œsymbol = "main", kind = "function"
- åˆ›å»º DEFINES ç±»åž‹è¾¹ï¼ˆè‹¥æœ‰å¼•ç”¨ï¼‰

### SC-SP-003ï¼šå¤„ç† ReadAccess å¼•ç”¨

**Given**: SCIP ç´¢å¼•åŒ…å«ï¼š
- èŠ‚ç‚¹ A å®šä¹‰ï¼ˆsymbol_roles = 1ï¼‰
- èŠ‚ç‚¹ B å¯¹ A çš„å¼•ç”¨ï¼ˆsymbol_roles = 8, ReadAccessï¼‰
**When**: æ‰§è¡Œè§£æž
**Then**:
- åˆ›å»ºè¾¹ï¼šB â†’ A, type = CALLS

### SC-SP-004ï¼šSCIP æ–‡ä»¶ä¸å­˜åœ¨

**Given**: `index.scip` æ–‡ä»¶ä¸å­˜åœ¨
**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
**Then**:
- è¿”å›žé”™è¯¯ï¼š`SCIP index not found: index.scip`
- æç¤ºè¿è¡Œç´¢å¼•å‘½ä»¤ï¼š`Run: npx scip-typescript index`
- é€€å‡ºç  1

### SC-SP-005ï¼šSCIP è§£æžå¤±è´¥é™çº§

**Given**: `index.scip` æ–‡ä»¶æŸåæˆ–æ ¼å¼ä¸å…¼å®¹
**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
**Then**:
- è¾“å‡ºè­¦å‘Šï¼š`SCIP parsing failed, falling back to regex matching`
- ä½¿ç”¨æ­£åˆ™åŒ¹é…æ‰«ææºæ–‡ä»¶
- è¾“å‡ºç½®ä¿¡åº¦æ ‡è®°ï¼š`confidence: low`
- ä»ç„¶ç”Ÿæˆå›¾æ•°æ®ï¼ˆç²¾åº¦é™ä½Žï¼‰

### SC-SP-006ï¼šå¢žé‡æ›´æ–°æ£€æµ‹

**Given**:
- å›¾æ•°æ®åº“å­˜åœ¨ä¸”æœ‰æ•°æ®
- `index.scip` mtime > å›¾æ•°æ®åº“ mtime
**When**: æ‰§è¡Œ `scip-to-graph.sh parse --incremental`
**Then**:
- æ£€æµ‹åˆ°ç´¢å¼•æ›´æ–°
- æ¸…ç†æ—§æ•°æ®
- é‡æ–°å¯¼å…¥æ–°æ•°æ®
- è¾“å‡ºï¼š`Incremental update: index newer than database`

### SC-SP-007ï¼šæ— éœ€æ›´æ–°

**Given**:
- å›¾æ•°æ®åº“å­˜åœ¨ä¸”æœ‰æ•°æ®
- `index.scip` mtime < å›¾æ•°æ®åº“ mtime
**When**: æ‰§è¡Œ `scip-to-graph.sh parse --incremental`
**Then**:
- è¾“å‡ºï¼š`Database up-to-date, skipping parse`
- ä¸æ‰§è¡Œè§£æž
- é€€å‡ºç  0

### SC-SP-008ï¼šå¼ºåˆ¶å®Œå…¨é‡å»º

**Given**: å›¾æ•°æ®åº“å·²å­˜åœ¨
**When**: æ‰§è¡Œ `scip-to-graph.sh parse --force`
**Then**:
- æ¸…ç©ºçŽ°æœ‰æ•°æ®
- å®Œå…¨é‡æ–°è§£æž
- è¾“å‡ºï¼š`Force rebuild: cleared existing data`

### SC-SP-009ï¼šè§£æžç»Ÿè®¡è¾“å‡º

**Given**: è§£æžå®Œæˆ
**When**: æŸ¥çœ‹è¾“å‡º
**Then**:
- è¾“å‡º JSON æ ¼å¼ç»Ÿè®¡ï¼š
  ```json
  {
    "documents": 1,
    "symbols": 187,
    "occurrences": 494,
    "edges": {
      "DEFINES": 187,
      "IMPORTS": 0,
      "CALLS": 307,
      "MODIFIES": 0
    },
    "confidence": "high",
    "source": "scip"
  }
  ```

### SC-SP-010ï¼šè‡ªå®šä¹‰ç´¢å¼•è·¯å¾„

**Given**: SCIP ç´¢å¼•ä½äºŽ `build/index.scip`
**When**: æ‰§è¡Œ `SCIP_INDEX_PATH=build/index.scip scip-to-graph.sh parse`
**Then**:
- ä»Ž `build/index.scip` è¯»å–ç´¢å¼•
- è§£æžæˆåŠŸ

---

## è¿½æº¯çŸ©é˜µ

| Requirement | Scenarios | AC |
|-------------|-----------|-----|
| REQ-SP-001 | SC-SP-001, SC-SP-004, SC-SP-010 | AC-002 |
| REQ-SP-002 | SC-SP-001, SC-SP-002 | AC-002 |
| REQ-SP-003 | SC-SP-002, SC-SP-003 | AC-002 |
| REQ-SP-004 | SC-SP-001 | AC-002 |
| REQ-SP-005 | SC-SP-006, SC-SP-007, SC-SP-008 | AC-002 |
| REQ-SP-006 | SC-SP-005 | AC-002 |
| REQ-SP-007 | SC-SP-009 | AC-002 |
total 120
drwxr-xr-x   6 ozbombor  staff    192 Jan 18 05:53 .
drwxr-xr-x  57 ozbombor  staff   1824 Jan 18 05:51 ..
-rw-r--r--   1 ozbombor  staff  37831 Jan 18 05:53 c4.md
-rw-r--r--   1 ozbombor  staff   1708 Jan 13 19:21 fitness-rules.md
-rw-r--r--   1 ozbombor  staff   4040 Jan 13 20:03 hotspots.md
-rw-r--r--   1 ozbombor  staff   9376 Jan 13 19:19 module-graph.md
# C4 Architecture Map: Code Intelligence MCP Server

> **Version**: 1.4.0
> **Owner**: Architecture Owner
> **Created**: 2026-01-11
> **Last Updated**: 2026-01-18 (upgrade-code-intelligence-capabilitiesï¼šè¾¹ç±»åž‹è§£æžæ‰©å±•ã€Schema v3 è¿ç§»ã€CKB MCP é›†æˆã€å›¾+å‘é‡èžåˆæŸ¥è¯¢ã€è‡ªåŠ¨é¢„çƒ­)
> **Freshness Check**: 90 days

---

## C1: System Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              External Users                              â”‚
â”‚                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚ Claude Code  â”‚    â”‚ AI Assistantsâ”‚    â”‚   IDE        â”‚             â”‚
â”‚    â”‚   (CLI)      â”‚    â”‚              â”‚    â”‚  Plugins     â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚              â”‚                  â”‚                  â”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                 â”‚                                        â”‚
â”‚                                 â”‚ MCP Protocol (stdio)                   â”‚
â”‚                                 â–¼                                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚                                                                â”‚   â”‚
â”‚    â”‚               Code Intelligence MCP Server                     â”‚   â”‚
â”‚    â”‚                                                                â”‚   â”‚
â”‚    â”‚   Provides: semantic search, call chain tracing, bug          â”‚   â”‚
â”‚    â”‚             localization, complexity analysis, graph RAG      â”‚   â”‚
â”‚    â”‚                                                                â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                        â”‚
â”‚                                 â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚                  â”‚                  â”‚                     â”‚
â”‚              â–¼                  â–¼                  â–¼                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚    â”‚   Ollama /   â”‚    â”‚   CKB MCP    â”‚    â”‚   Git        â”‚             â”‚
â”‚    â”‚   OpenAI     â”‚    â”‚   Server     â”‚    â”‚   Repository â”‚             â”‚
â”‚    â”‚ (Embedding)  â”‚    â”‚ (Graph)      â”‚    â”‚              â”‚             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### System Boundary

| å…ƒç´  | ç±»åž‹ | æè¿° |
|------|------|------|
| Code Intelligence MCP Server | System | æœ¬ç³»ç»Ÿï¼šä¸º AI ç¼–ç¨‹åŠ©æ‰‹æä¾›ä»£ç æ™ºèƒ½èƒ½åŠ› |
| Claude Code | External User | ä¸»è¦ç”¨æˆ·ï¼šAnthropic å®˜æ–¹ CLI å·¥å…· |
| AI Assistants | External User | å…¶ä»– AI ç¼–ç¨‹åŠ©æ‰‹ |
| IDE Plugins | External User | IDE é›†æˆæ’ä»¶ |
| Ollama / OpenAI | External System | Embedding ç”ŸæˆæœåŠ¡ï¼ˆå¯é€‰ï¼‰ |
| CKB MCP Server | External System | å›¾åŸºä»£ç åˆ†æžæœåŠ¡ï¼ˆå¯é€‰ï¼‰ |
| Git Repository | External System | ç›®æ ‡ä»£ç ä»“åº“ |

---

## C2: Container Level

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Code Intelligence MCP Server                        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                        Integration Layer                            â”‚â”‚
â”‚  â”‚                                                                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚  src/server.ts  â”‚    â”‚          hooks/*.sh                     â”‚â”‚â”‚
â”‚  â”‚  â”‚  (MCP Thin      â”‚    â”‚  (augment-context-global.sh             â”‚â”‚â”‚
â”‚  â”‚  â”‚   Shell)        â”‚    â”‚   augment-context-with-embedding.sh     â”‚â”‚â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚   pre-commit)  [NEW: Phase 2]           â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â”‚ execAsync                                â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                          Core Layer                                 â”‚â”‚
â”‚  â”‚                                                                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ embedding   â”‚  â”‚ call-chain  â”‚  â”‚ bug-locator â”‚  â”‚ complexity  â”‚â”‚â”‚
â”‚  â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                                                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ graph-rag   â”‚  â”‚  indexer    â”‚  â”‚ hotspot-    â”‚  â”‚ boundary-   â”‚â”‚â”‚
â”‚  â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚  â”‚ analyzer.sh â”‚  â”‚ detector.sh â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                            â”‚                        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ [ENHANCED: Phase 2]   â”‚â”‚
â”‚  â”‚  â”‚ pattern-    â”‚  â”‚  ast-diff   â”‚          â”‚ --with-bug-history    â”‚â”‚
â”‚  â”‚  â”‚ learner.sh  â”‚  â”‚    .sh      â”‚          â”‚                        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                        â”‚â”‚
â”‚  â”‚                                            â–¼                        â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚              [NEW: Phase 2 Containers]                       â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ cache-      â”‚  â”‚ dependency- â”‚  â”‚ context-    â”‚          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ manager.sh  â”‚  â”‚ guard.sh    â”‚  â”‚ layer.sh    â”‚          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ L1å†…å­˜+L2æ–‡ä»¶â”‚  â”‚ å¾ªçŽ¯æ£€æµ‹    â”‚  â”‚ Commitåˆ†ç±»   â”‚          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ blob hash  â”‚  â”‚ è§„åˆ™æ ¡éªŒ    â”‚  â”‚ BugåŽ†å²     â”‚          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ federation- â”‚                                            â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ lite.sh     â”‚                                            â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚             â”‚                                            â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â”‚ è·¨ä»“åº“å¥‘çº¦   â”‚                                            â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â”‚ source                                   â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         Shared Layer                                â”‚â”‚
â”‚  â”‚                                                                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚      common.sh          â”‚    â”‚     cache-utils.sh      â”‚        â”‚â”‚
â”‚  â”‚  â”‚  (shared functions,     â”‚    â”‚  (caching utilities)    â”‚        â”‚â”‚
â”‚  â”‚  â”‚   config, logging)      â”‚    â”‚  [è¢« cache-manager.sh   â”‚        â”‚â”‚
â”‚  â”‚  â”‚  [ENHANCED: Phase 2]    â”‚    â”‚   è°ƒç”¨ï¼Œåä½œå±‚]          â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      Config Layer [NEW: Phase 2]                    â”‚â”‚
â”‚  â”‚                                                                     â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚  â”‚  config/arch-rules.yaml â”‚    â”‚  config/federation.yaml â”‚        â”‚â”‚
â”‚  â”‚  â”‚  (æž¶æž„è§„åˆ™å®šä¹‰)          â”‚    â”‚  (è”é‚¦ä»“åº“é…ç½®)          â”‚        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Container Inventory

| Container | è·¯å¾„ | ç±»åž‹ | èŒè´£ | æŠ€æœ¯æ ˆ |
|-----------|------|------|------|--------|
| MCP Server | `src/server.ts` | Application | MCP åè®®å¤„ç†ï¼Œå·¥å…·è°ƒåº¦ | TypeScript, Node.js |
| Global Hook | `hooks/augment-context-global.sh` | Hook | å…¨å±€ä¸Šä¸‹æ–‡æ³¨å…¥ï¼Œ4 ç»´æ„å›¾åˆ†æž | Bash |
| **Pre-commit Hook** | `hooks/pre-commit` | Hook | æž¶æž„è§„åˆ™æ ¡éªŒ + å¾ªçŽ¯ä¾èµ–æ£€æµ‹ | Bash |
| Embedding Search | `scripts/embedding.sh` | Script | è¯­ä¹‰ä»£ç æœç´¢ | Bash |
| Call Chain | `scripts/call-chain.sh` | Script | è°ƒç”¨é“¾è¿½è¸ªï¼Œæ•°æ®æµè¿½è¸ª | Bash |
| Bug Locator | `scripts/bug-locator.sh` | Script | Bug ä½ç½®å®šä½ï¼ˆé›†æˆçƒ­ç‚¹ç®—æ³•ï¼‰ | Bash |
| Complexity | `scripts/complexity.sh` | Script | åœˆå¤æ‚åº¦åˆ†æž | Bash |
| Graph-RAG | `scripts/graph-rag.sh` | Script | å­å›¾æ£€ç´¢ï¼Œè¾¹ç•Œè¿‡æ»¤ | Bash |
| Indexer | `scripts/indexer.sh` | Script | Embedding ç´¢å¼•ç®¡ç† | Bash |
| Hotspot Analyzer | `scripts/hotspot-analyzer.sh` | Script | Frequency Ã— Complexity çƒ­ç‚¹è®¡ç®—ï¼Œ**Phase 2: Bug ä¿®å¤åŽ†å²æƒé‡** | Bash |
| Boundary Detector | `scripts/boundary-detector.sh` | Script | ç”¨æˆ·/åº“/ç”Ÿæˆä»£ç è¾¹ç•Œè¯†åˆ« | Bash |
| Pattern Learner | `scripts/pattern-learner.sh` | Script | è¯­ä¹‰æ¨¡å¼å­¦ä¹ ä¸Žå¼‚å¸¸æ£€æµ‹ | Bash |
| AST Diff | `scripts/ast-diff.sh` | Script | SCIP å¢žé‡ç´¢å¼• | Bash |
| **Cache Manager** | `scripts/cache-manager.sh` | Script | **å¤šçº§ç¼“å­˜ï¼ˆL1 å†…å­˜ + L2 æ–‡ä»¶ï¼‰ã€mtime + blob hash ç²¾ç¡®å¤±æ•ˆã€LRU æ·˜æ±°** | Bash |
| **Dependency Guard** | `scripts/dependency-guard.sh` | Script | **å¾ªçŽ¯ä¾èµ–æ£€æµ‹ï¼ˆDFSï¼‰ã€æž¶æž„è§„åˆ™æ ¡éªŒã€Pre-commit é›†æˆ** | Bash |
| **Context Layer** | `scripts/context-layer.sh` | Script | **Commit è¯­ä¹‰åˆ†ç±»ï¼ˆfix/feat/refactorï¼‰ã€Bug ä¿®å¤åŽ†å²æå–** | Bash |
| **Federation Lite** | `scripts/federation-lite.sh` | Script | **è·¨ä»“åº“å¥‘çº¦å‘çŽ°ã€ç¬¦å·æå–ã€è”é‚¦ç´¢å¼•ç®¡ç†** | Bash |
| Common | `scripts/common.sh` | Shared | å…±äº«å‡½æ•°ã€é…ç½®ã€æ—¥å¿—ï¼Œ**Phase 2: æ–°å¢žç¼“å­˜å…±äº«å‡½æ•°** | Bash |
| Cache Utils | `scripts/cache-utils.sh` | Shared | ç¼“å­˜ç®¡ç†ï¼ˆL2 åŸºç¡€å‡½æ•°ï¼‰ï¼Œ**è¢« cache-manager.sh è°ƒç”¨** | Bash |
| **Arch Rules Config** | `config/arch-rules.yaml` | Config | **æž¶æž„è§„åˆ™å®šä¹‰ï¼ˆç¦æ­¢å¯¼å…¥ã€å¾ªçŽ¯æ£€æµ‹ç™½åå•ï¼‰** | YAML |
| **Federation Config** | `config/federation.yaml` | Config | **è”é‚¦ä»“åº“é…ç½®ï¼ˆæ˜¾å¼è·¯å¾„ + è‡ªåŠ¨å‘çŽ°ï¼‰** | YAML |
| ***Graph Store*** | `scripts/graph-store.sh` | Script | ***SQLite å›¾å­˜å‚¨ï¼Œ9 ç§è¾¹ç±»åž‹ CRUDï¼ŒSchema v3 è¿ç§»ï¼Œå­¤å„¿èŠ‚ç‚¹æŸ¥è¯¢*** | Bash |
| ***SCIP Parser*** | `scripts/scip-to-graph.sh` | Script | ***SCIP ç´¢å¼•è§£æžï¼Œsymbol_roles æ˜ å°„ï¼ŒIMPLEMENTS/EXTENDS/RETURNS_TYPE è¾¹ç±»åž‹æå–ï¼Œæ­£åˆ™é™çº§*** | Bash |
| ***Daemon*** | `scripts/daemon.sh` | Script | ***å¸¸é©»å®ˆæŠ¤è¿›ç¨‹ï¼ŒUnix Socket é€šä¿¡ï¼Œè‡ªåŠ¨é¢„çƒ­ï¼ŒP95 < 500ms*** | Bash |
| ***Features Config*** | `config/features.yaml` | Config | ***åŠŸèƒ½å¼€å…³é…ç½®ï¼ˆLLM é‡æŽ’åºã€å­¤å„¿æ£€æµ‹ã€æ¨¡å¼å‘çŽ°ï¼‰*** | YAML |
| ****AST Delta TS**** | `src/ast-delta.ts` | Module | ****TypeScript tree-sitter è§£æžè–„å£³ï¼ŒAST å·®å¼‚è®¡ç®—**** | TypeScript |
| ****AST Delta**** | `scripts/ast-delta.sh` | Script | ****å¢žé‡ AST è§£æžåè°ƒï¼Œç¼“å­˜ç®¡ç†ï¼Œå›¾æ›´æ–°è§¦å‘**** | Bash |
| ****Impact Analyzer**** | `scripts/impact-analyzer.sh` | Script | ****ä¼ é€’æ€§å½±å“åˆ†æžï¼ŒBFS å›¾éåŽ†ï¼Œç½®ä¿¡åº¦è¡°å‡**** | Bash |
| ****COD Visualizer**** | `scripts/cod-visualizer.sh` | Script | ****æž¶æž„å¯è§†åŒ–ï¼ŒMermaid + D3.js JSON è¾“å‡º**** | Bash |
| ****Intent Learner**** | `scripts/intent-learner.sh` | Script | ****æŸ¥è¯¢åŽ†å²è®°å½•ï¼Œåå¥½åˆ†æ•°è®¡ç®—ï¼Œ90 å¤©è‡ªåŠ¨æ¸…ç†**** | Bash |
| ****Vuln Tracker**** | `scripts/vuln-tracker.sh` | Script | ****npm audit é›†æˆï¼Œæ¼æ´žæ‰«æï¼Œä¾èµ–ä¼ æ’­è¿½è¸ª**** | Bash |
| *****ADR Parser***** | `scripts/adr-parser.sh` | Script | *****ADR è§£æžä¸Žå…³è”ï¼ŒMADR/Nygard æ ¼å¼æ”¯æŒï¼Œç”Ÿæˆ ADR_RELATED è¾¹***** | Bash |
| *****GitHub Action***** | `.github/workflows/arch-check.yml` | CI/CD | *****PR è‡ªåŠ¨æž¶æž„æ£€æŸ¥ï¼Œå¾ªçŽ¯ä¾èµ–/å­¤å„¿æ¨¡å—/æž¶æž„è§„åˆ™æ£€æµ‹***** | YAML |
| *****GitLab CI Template***** | `.gitlab-ci.yml.template` | CI/CD | *****GitLab MR æž¶æž„æ£€æŸ¥æ¨¡æ¿***** | YAML |
| ******CKB Client Manager****** | `src/server.ts::CKBClientManager` | Component | ******CKB MCP è°ƒç”¨ç®¡ç†ï¼Œå¥åº·æ£€æŸ¥ï¼Œé™çº§çŠ¶æ€ç®¡ç†ï¼Œ60s å†·å´æœŸ****** | TypeScript |
| ******Fusion Search****** | `scripts/embedding.sh::fusion_search()` | Function | ******å›¾+å‘é‡èžåˆæŸ¥è¯¢ï¼Œ1-hop å›¾æ‰©å±•ï¼ŒToken é¢„ç®—åˆ†é…****** | Bash |

**æ³¨**ï¼šç²—ä½“ä¸º `augment-upgrade-phase2` å˜æ›´æ–°å¢žæˆ–å¢žå¼ºçš„ Containerã€‚æ–œä½“ç²—ä½“ä¸º `augment-parity` å˜æ›´æ–°å¢žçš„ Containerã€‚å››æ˜Ÿç²—ä½“ä¸º `achieve-augment-full-parity` å˜æ›´æ–°å¢žçš„ Containerã€‚äº”æ˜Ÿç²—ä½“ä¸º `augment-parity-final-gaps` å˜æ›´æ–°å¢žçš„ Containerã€‚å…­æ˜Ÿç²—ä½“ä¸º `upgrade-code-intelligence-capabilities` å˜æ›´æ–°å¢žçš„ Containerã€‚

**augment-parity-final-gaps å¢žå¼ºçš„ Container**ï¼š
| Container | å¢žå¼ºå†…å®¹ |
|-----------|----------|
| `scripts/scip-to-graph.sh` | è¾¹ç±»åž‹æ‰©å±•ï¼šIMPLEMENTS/EXTENDS/RETURNS_TYPE/ADR_RELATED |
| `scripts/graph-store.sh` | æ–°å¢ž `find-path`ï¼ˆA-B æœ€çŸ­è·¯å¾„ï¼‰ã€`migrate`ï¼ˆSchema è¿ç§»ï¼‰ |
| `scripts/intent-learner.sh` | å¯¹è¯ä¸Šä¸‹æ–‡æŒä¹…åŒ–ã€ä¼šè¯ç®¡ç†ã€è¿žç»­æ€§åŠ æƒ |
| `scripts/daemon.sh` | é¢„çƒ­æœºåˆ¶ï¼ˆwarmupï¼‰ã€è¯·æ±‚å–æ¶ˆåè®® |
| `scripts/cache-manager.sh` | å­å›¾ LRU ç¼“å­˜ï¼ˆSQLite æŒä¹…åŒ–ï¼Œè·¨è¿›ç¨‹å…±äº«ï¼‰ |
| `scripts/bug-locator.sh` | å½±å“åˆ†æžèžåˆï¼ˆ--with-impact, --impact-depthï¼‰ |
| `hooks/augment-context-global.sh` | 5 å±‚ç»“æž„åŒ–ä¸Šä¸‹æ–‡è¾“å‡ºã€DevBooks é€‚é…æ³¨å…¥ |
| `scripts/common.sh` | æ–°å¢ž detect_devbooks()ã€load_devbooks_context() |

**upgrade-code-intelligence-capabilities å¢žå¼ºçš„ Container**ï¼š
| Container | å¢žå¼ºå†…å®¹ |
# æ¨¡å—ä¾èµ–å›¾ï¼šCode Intelligence MCP Server

> ç”Ÿæˆæ—¶é—´ï¼š2026-01-10
> ç”Ÿæˆæ–¹å¼ï¼šä¼ ç»Ÿåˆ†æžï¼ˆSCIP ç´¢å¼•ä¸å¯ç”¨ï¼‰

---

## æž¶æž„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        External Clients                          â”‚
â”‚                    (Claude Code, AI Assistants)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ MCP Protocol (stdio)
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         src/server.ts                            â”‚
â”‚                    (MCP Server - Thin Shell)                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ListTools   â”‚  â”‚ CallTool    â”‚  â”‚ Transport   â”‚              â”‚
â”‚  â”‚ Handler     â”‚  â”‚ Handler     â”‚  â”‚ (stdio)     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ execAsync (shell)
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        scripts/                                  â”‚
â”‚                    (Core Functionality)                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ embedding   â”‚  â”‚ call-chain  â”‚  â”‚ bug-locator â”‚              â”‚
â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ complexity  â”‚  â”‚ graph-rag   â”‚  â”‚  indexer    â”‚              â”‚
â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚  common     â”‚  â”‚ cache-utils â”‚  (shared utilities)           â”‚
â”‚  â”‚    .sh      â”‚  â”‚    .sh      â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      External Tools                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ripgrep    â”‚  â”‚     jq      â”‚  â”‚   Ollama/   â”‚              â”‚
â”‚  â”‚    (rg)     â”‚  â”‚             â”‚  â”‚   OpenAI    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚  â”‚  CKB MCP    â”‚  (optional - for graph-based analysis)         â”‚
â”‚  â”‚   Server    â”‚                                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—æ¸…å•

### æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | è·¯å¾„ | èŒè´£ | ä¾èµ– |
|------|------|------|------|
| MCP Server | `src/server.ts` | MCP åè®®å¤„ç†ï¼Œå·¥å…·è°ƒåº¦ | @modelcontextprotocol/sdk |
| Embedding | `scripts/embedding.sh` | è¯­ä¹‰ä»£ç æœç´¢ | common.sh, Ollama/OpenAI |
| Call Chain | `scripts/call-chain.sh` | è°ƒç”¨é“¾è¿½è¸ª | common.sh, CKB MCP |
| Bug Locator | `scripts/bug-locator.sh` | Bug ä½ç½®å®šä½ | common.sh, embedding.sh |
| Complexity | `scripts/complexity.sh` | å¤æ‚åº¦åˆ†æž | common.sh |
| Graph-RAG | `scripts/graph-rag.sh` | å›¾åŸºä¸Šä¸‹æ–‡æ£€ç´¢ | common.sh, CKB MCP |
| Indexer | `scripts/indexer.sh` | ç´¢å¼•ç®¡ç† | common.sh |

### å…±äº«æ¨¡å—

| æ¨¡å— | è·¯å¾„ | èŒè´£ |
|------|------|------|
| Common | `scripts/common.sh` | å…±äº«å‡½æ•°ã€é…ç½®ã€æ—¥å¿— |
| Cache Utils | `scripts/cache-utils.sh` | ç¼“å­˜ç®¡ç† |
| Reranker | `scripts/reranker.sh` | LLM é‡æŽ’åº |

### é’©å­æ¨¡å—

| æ¨¡å— | è·¯å¾„ | èŒè´£ |
|------|------|------|
| Global Context | `hooks/augment-context-global.sh` | å…¨å±€ä¸Šä¸‹æ–‡æ³¨å…¥ |
| Embedding Context | `hooks/augment-context-with-embedding.sh` | Embedding å¢žå¼ºä¸Šä¸‹æ–‡ |
| Context | `hooks/augment-context.sh` | åŸºç¡€ä¸Šä¸‹æ–‡æ³¨å…¥ |
| Cache Manager | `hooks/cache-manager.sh` | é’©å­ç¼“å­˜ç®¡ç† |

### CLI å…¥å£

| æ¨¡å— | è·¯å¾„ | èŒè´£ |
|------|------|------|
| MCP å…¥å£ | `bin/code-intelligence-mcp` | å¯åŠ¨ MCP Server |
| æœç´¢å…¥å£ | `bin/ci-search` | ç‹¬ç«‹æœç´¢å‘½ä»¤ |

---

## ä¾èµ–çŸ©é˜µ

```
                    â”‚ common â”‚ cache  â”‚ embed  â”‚ call   â”‚ bug    â”‚ graph  â”‚
                    â”‚  .sh   â”‚ utils  â”‚ ding   â”‚ chain  â”‚ locatorâ”‚  rag   â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
server.ts           â”‚   -    â”‚   -    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚
embedding.sh        â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚
call-chain.sh       â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚
bug-locator.sh      â”‚   âœ“    â”‚   -    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚
complexity.sh       â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚
graph-rag.sh        â”‚   âœ“    â”‚   âœ“    â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚
indexer.sh          â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚
```

**å›¾ä¾‹**ï¼š
- `âœ“` = ç›´æŽ¥ä¾èµ–
- `-` = æ— ä¾èµ–

---

## ä¾èµ–æ–¹å‘è§„åˆ™

### å…è®¸çš„ä¾èµ–æ–¹å‘

```
server.ts â†’ scripts/*.sh â†’ common.sh
                        â†’ cache-utils.sh
                        â†’ å¤–éƒ¨å·¥å…·
```

### ç¦æ­¢çš„ä¾èµ–

- âŒ scripts/*.sh â†’ src/*.tsï¼ˆè„šæœ¬ä¸å¾—ä¾èµ– TypeScriptï¼‰
- âŒ common.sh â†’ å…¶ä»–åŠŸèƒ½è„šæœ¬ï¼ˆå…±äº«æ¨¡å—ä¸å¾—ä¾èµ–åŠŸèƒ½æ¨¡å—ï¼‰
- âŒ å¾ªçŽ¯ä¾èµ–

---

## å¤–éƒ¨ä¾èµ–

### å¿…éœ€ä¾èµ–

| ä¾èµ– | ç±»åž‹ | æ¥æº |
|------|------|------|
| @modelcontextprotocol/sdk | npm | package.json |
| Node.js | è¿è¡Œæ—¶ | ç³»ç»Ÿ |
| Bash | è¿è¡Œæ—¶ | ç³»ç»Ÿ |

### æŽ¨èä¾èµ–

| ä¾èµ– | ç±»åž‹ | ç”¨é€” |
|------|------|------|
| ripgrep (rg) | CLI å·¥å…· | æ–‡æœ¬æœç´¢ |
| jq | CLI å·¥å…· | JSON å¤„ç† |

### å¯é€‰ä¾èµ–

| ä¾èµ– | ç±»åž‹ | ç”¨é€” |
|------|------|------|
| Ollama | æœåŠ¡ | æœ¬åœ° Embedding |
| OpenAI API | æœåŠ¡ | äº‘ç«¯ Embedding |
| CKB MCP Server | MCP | å›¾åŸºä»£ç åˆ†æž |
# é¡¹ç›®ç”»åƒï¼šCode Intelligence MCP Server

> ç”Ÿæˆæ—¶é—´ï¼š2026-01-10ï¼ˆæ›´æ–°ï¼š2026-01-11ï¼‰
> ç”Ÿæˆæ–¹å¼ï¼šBrownfield Bootstrapï¼ˆSCIP ç´¢å¼•å¯ç”¨ï¼‰

---

## ç¬¬ä¸€å±‚ï¼šå¿«é€Ÿå®šä½ï¼ˆ30ç§’é˜…è¯»ï¼‰

### é¡¹ç›®æ¦‚è¿°

| å±žæ€§ | å€¼ |
|------|-----|
| é¡¹ç›®åç§° | code-intelligence-mcp |
| é¡¹ç›®ç±»åž‹ | MCP Serverï¼ˆModel Context Protocolï¼‰ |
| ä¸»è¦ç”¨é€” | ä¸º AI ç¼–ç¨‹åŠ©æ‰‹æä¾›ä»£ç æ™ºèƒ½èƒ½åŠ› |
| æŠ€æœ¯æ ˆ | TypeScript + Node.js + Shell Scripts |
| å½“å‰ç‰ˆæœ¬ | 0.2.0 |

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | å…¥å£ |
|------|------|------|
| è¯­ä¹‰æœç´¢ | ä½¿ç”¨ Embedding è¿›è¡Œä»£ç è¯­ä¹‰æœç´¢ | `ci_search` |
| è°ƒç”¨é“¾è¿½è¸ª | è¿½è¸ªå‡½æ•°è°ƒç”¨é“¾ï¼ˆcallers/calleesï¼‰ | `ci_call_chain` |
| Bug å®šä½ | åŸºäºŽé”™è¯¯æè¿°æ™ºèƒ½å®šä½æ½œåœ¨ Bug ä½ç½® | `ci_bug_locate` |
| å¤æ‚åº¦åˆ†æž | ä»£ç å¤æ‚åº¦æŒ‡æ ‡åˆ†æž | `ci_complexity` |
| Graph-RAG | å›¾åŸºæ£€ç´¢å¢žå¼ºç”Ÿæˆä¸Šä¸‹æ–‡ | `ci_graph_rag` |
| ç´¢å¼•ç®¡ç† | Embedding ç´¢å¼•çŠ¶æ€ç®¡ç† | `ci_index_status` |

### ç›®å½•ç»“æž„

```
code-intelligence-mcp/
â”œâ”€â”€ src/                    # TypeScript æºç 
â”‚   â””â”€â”€ server.ts          # MCP æœåŠ¡å™¨å…¥å£ï¼ˆè–„å£³ï¼‰
â”œâ”€â”€ scripts/               # æ ¸å¿ƒåŠŸèƒ½è„šæœ¬
â”‚   â”œâ”€â”€ embedding.sh       # Embedding æœç´¢
â”‚   â”œâ”€â”€ call-chain.sh      # è°ƒç”¨é“¾è¿½è¸ª
â”‚   â”œâ”€â”€ bug-locator.sh     # Bug å®šä½
â”‚   â”œâ”€â”€ complexity.sh      # å¤æ‚åº¦åˆ†æž
â”‚   â”œâ”€â”€ graph-rag.sh       # Graph-RAG
â”‚   â””â”€â”€ indexer.sh         # ç´¢å¼•ç®¡ç†
â”œâ”€â”€ hooks/                 # Claude Code é’©å­
â”‚   â””â”€â”€ augment-context-global.sh  # å…¨å±€ä¸Šä¸‹æ–‡æ³¨å…¥
â”œâ”€â”€ bin/                   # CLI å…¥å£
â”‚   â”œâ”€â”€ code-intelligence-mcp     # MCP æœåŠ¡å™¨å¯åŠ¨å™¨
â”‚   â””â”€â”€ ci-search                 # ç‹¬ç«‹æœç´¢å‘½ä»¤
â”œâ”€â”€ config/                # é…ç½®æ¨¡æ¿
â”œâ”€â”€ dev-playbooks/         # DevBooks Skills å’Œæ¨¡æ¿
â””â”€â”€ dev-playbooks/              # OpenSpec è§„èŒƒç›®å½•
```

---

## ç¬¬äºŒå±‚ï¼šå¼€å‘çº¦å®šï¼ˆ3åˆ†é’Ÿé˜…è¯»ï¼‰

### æŠ€æœ¯æ ˆè¯¦æƒ…

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬è¦æ±‚ |
|------|------|----------|
| è¿è¡Œæ—¶ | Node.js | >= 18.0.0 |
| è¯­è¨€ | TypeScript | ^5.0.0 |
| åè®® | MCP SDK | ^1.0.0 |
| è„šæœ¬ | Bash | - |
| å·¥å…· | ripgrep, jq | - |

### æž¶æž„æ¨¡å¼

**è–„å£³æ¨¡å¼ï¼ˆThin Shellï¼‰**ï¼š
- MCP Server ä½¿ç”¨ TypeScript ä½œä¸ºè–„å£³
- æ ¸å¿ƒåŠŸèƒ½ç”± Shell è„šæœ¬å®žçŽ°
- è®¾è®¡çº¦æŸï¼š`CON-TECH-002: MCP Server ä½¿ç”¨ Node.js è–„å£³è°ƒç”¨ Shell è„šæœ¬`

```
[Claude Code] â†’ [MCP Protocol] â†’ [server.ts] â†’ [scripts/*.sh]
```

### å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | ç”¨é€” |
|------|------|
| `npm install` | å®‰è£…ä¾èµ– |
| `npm run build` | ç¼–è¯‘ TypeScript |
| `npm run start` | å¯åŠ¨ MCP Server |
| `npm run lint` | è¿è¡Œ ShellCheck |
| `./install.sh` | å®‰è£…è„šæœ¬ |
| `./install.sh --global` | å…¨å±€å®‰è£… |
| `./install.sh --with-hook` | å®‰è£… Claude Code é’©å­ |

### ä»£ç é£Žæ ¼çº¦å®š

- TypeScriptï¼šä¸¥æ ¼æ¨¡å¼ï¼ˆ`strict: true`ï¼‰
- ES æ¨¡å—ï¼šä½¿ç”¨ `NodeNext` æ¨¡å—è§£æž
- Shell è„šæœ¬ï¼šä½¿ç”¨ `set -euo pipefail`
- å‘½åï¼š
  - MCP å·¥å…·åï¼š`ci_*` å‰ç¼€ï¼ˆsnake_caseï¼‰
  - è„šæœ¬æ–‡ä»¶ï¼š`*.sh`ï¼ˆkebab-caseï¼‰

### æµ‹è¯•ç­–ç•¥

- å½“å‰çŠ¶æ€ï¼šæ— è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆ`npm test` è¾“å‡º "No tests yet"ï¼‰
- å»ºè®®ï¼šæ·»åŠ è„šæœ¬å•å…ƒæµ‹è¯•å’Œ MCP é›†æˆæµ‹è¯•

---

## ç¬¬ä¸‰å±‚ï¼šæ·±åº¦çº¦å®šï¼ˆæŒ‰éœ€é˜…è¯»ï¼‰

### è¾¹ç•Œè¯†åˆ«

| ç±»åž‹ | è·¯å¾„ | è¯´æ˜Ž |
|------|------|------|
| ç”¨æˆ·ä»£ç  | `src/`, `scripts/`, `hooks/` | å¯ä¿®æ”¹ |
| åº“ä»£ç  | `node_modules/` | ä¸å¯å˜æŽ¥å£ |
| ç”Ÿæˆä»£ç  | `dist/` | ç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹ |
| é…ç½®æ¨¡æ¿ | `config/` | å¤åˆ¶åŽä¿®æ”¹ |
| DevBooks | `dev-playbooks/` | ç‹¬ç«‹å­é¡¹ç›® |

### ä¾èµ–æ–¹å‘çº¦æŸ

```
server.ts â†’ scripts/*.sh â†’ å¤–éƒ¨å·¥å…· (rg, jq, CKB MCP)
     â†“
  MCP SDK
```

ç¦æ­¢ï¼š
- scripts ä¸å¾—ç›´æŽ¥å¯¼å…¥ TypeScript æ¨¡å—
- å¾ªçŽ¯ä¾èµ–

### å¤–éƒ¨ä¾èµ–

| ä¾èµ– | ç”¨é€” | å¿…éœ€ |
|------|------|------|
| ripgrep (rg) | æ–‡æœ¬æœç´¢ | æŽ¨è |
| jq | JSON å¤„ç† | æŽ¨è |
| Ollama / OpenAI | Embedding ç”Ÿæˆ | å¯é€‰ |
| CKB MCP Server | å›¾åŸºä»£ç åˆ†æž | å¯é€‰ |

### é…ç½®å±‚çº§

1. **å…¨å±€é…ç½®**ï¼š`~/.claude/settings.json`ï¼ˆé’©å­é…ç½®ï¼‰
2. **é¡¹ç›®é…ç½®**ï¼š`.devbooks/config.yaml`ï¼ˆåè®®å‘çŽ°ï¼‰
3. **è¿è¡Œæ—¶é…ç½®**ï¼šçŽ¯å¢ƒå˜é‡

### å·²çŸ¥è®¾è®¡çº¦æŸ

| çº¦æŸ ID | æè¿° |
|---------|------|
| CON-TECH-002 | MCP Server ä½¿ç”¨ Node.js è–„å£³è°ƒç”¨ Shell è„šæœ¬ |
| CON-PUB-003 | å®‰è£…æ–¹å¼ç»Ÿä¸€ä¸º git clone + ./install.sh |

---

## éªŒæ”¶é”šç‚¹ï¼ˆæœ€å°åŸºçº¿ï¼‰

### çƒŸé›¾æµ‹è¯•

```bash
# 1. æ£€æŸ¥ CLI å¯ç”¨
./bin/code-intelligence-mcp --version  # æœŸæœ›è¾“å‡ºç‰ˆæœ¬å·

# 2. æ£€æŸ¥ TypeScript ç¼–è¯‘
npm run build  # æœŸæœ›æ— é”™è¯¯

# 3. æ£€æŸ¥è„šæœ¬æƒé™
ls -la scripts/*.sh  # æœŸæœ›æœ‰æ‰§è¡Œæƒé™
```

### å¥åº·æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | éªŒè¯å‘½ä»¤ | æœŸæœ›ç»“æžœ |
|--------|----------|----------|
| Node.js ç‰ˆæœ¬ | `node -v` | >= 18.0.0 |
| ä¾èµ–å®‰è£… | `npm ls` | æ— é”™è¯¯ |
| TypeScript ç¼–è¯‘ | `npm run build` | æˆåŠŸ |
| CLI å¯ç”¨ | `./bin/ci-search --help` | æ˜¾ç¤ºå¸®åŠ© |

---

## ç´¢å¼•çŠ¶æ€

| åŽç«¯ | çŠ¶æ€ | è¯´æ˜Ž |
|------|------|------|
| SCIP | âœ… å¯ç”¨ | index.scip (46KB) TypeScript ç´¢å¼• |
| LSP | ä¸å¯ç”¨ | æ— æœåŠ¡å™¨è¿è¡Œ |
| Git | âœ… å¯ç”¨ | é¦–æ¬¡æäº¤ 31fe235 |

**ç´¢å¼•åˆ·æ–°å‘½ä»¤**ï¼š
```bash
scip-typescript index --output index.scip
```
dev-playbooks/specs/_meta/project-profile.md:29:| ç´¢å¼•ç®¡ç† | Embedding ç´¢å¼•çŠ¶æ€ç®¡ç† | `ci_index_status` |
dev-playbooks/specs/architecture/c4.md:230:| `ci_index_status` | indexer.sh | å·²æœ‰ |
dev-playbooks/specs/architecture/c4.md:156:| Indexer | `scripts/indexer.sh` | Script | Embedding ç´¢å¼•ç®¡ç† | Bash |
dev-playbooks/specs/architecture/c4.md:230:| `ci_index_status` | indexer.sh | å·²æœ‰ |
dev-playbooks/specs/architecture/module-graph.md:80:| Indexer | `scripts/indexer.sh` | ç´¢å¼•ç®¡ç† | common.sh |
dev-playbooks/specs/architecture/module-graph.md:120:indexer.sh          â”‚   âœ“    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚   -    â”‚
dev-playbooks/specs/architecture/hotspots.md:50:| `scripts/indexer.sh` | 322 | ç´¢å¼•ç®¡ç† |
dev-playbooks/specs/_meta/project-profile.md:43:â”‚   â””â”€â”€ indexer.sh         # ç´¢å¼•ç®¡ç†
dev-playbooks/specs/_meta/key-concepts.md:32:**ç›¸å…³ç»„ä»¶**ï¼š`scripts/embedding.sh`ï¼Œ`scripts/indexer.sh`
dev-playbooks/specs/scip-parser/spec.md:91:**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
dev-playbooks/specs/scip-parser/spec.md:122:**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
dev-playbooks/specs/scip-parser/spec.md:131:**When**: æ‰§è¡Œ `scip-to-graph.sh parse`
dev-playbooks/specs/scip-parser/spec.md:143:**When**: æ‰§è¡Œ `scip-to-graph.sh parse --incremental`
dev-playbooks/specs/scip-parser/spec.md:155:**When**: æ‰§è¡Œ `scip-to-graph.sh parse --incremental`
dev-playbooks/specs/scip-parser/spec.md:164:**When**: æ‰§è¡Œ `scip-to-graph.sh parse --force`
dev-playbooks/specs/scip-parser/spec.md:195:**When**: æ‰§è¡Œ `SCIP_INDEX_PATH=build/index.scip scip-to-graph.sh parse`
dev-playbooks/specs/architecture/c4.md:170:| ***SCIP Parser*** | `scripts/scip-to-graph.sh` | Script | ***SCIP ç´¢å¼•è§£æžï¼Œsymbol_roles æ˜ å°„ï¼ŒIMPLEMENTS/EXTENDS/RETURNS_TYPE è¾¹ç±»åž‹æå–ï¼Œæ­£åˆ™é™çº§*** | Bash |
dev-playbooks/specs/architecture/c4.md:190:| `scripts/scip-to-graph.sh` | è¾¹ç±»åž‹æ‰©å±•ï¼šIMPLEMENTS/EXTENDS/RETURNS_TYPE/ADR_RELATED |
dev-playbooks/specs/architecture/c4.md:202:| `scripts/scip-to-graph.sh` | SCIP è§£æžå™¨æ‰©å±•ï¼šIMPLEMENTS/EXTENDS/RETURNS_TYPE è¾¹ç±»åž‹æå–ï¼Œæ­£åˆ™é™çº§è§£æž |
dev-playbooks/specs/architecture/c4.md:507:| 2026-01-15 | **augment-parity** | **Augment èƒ½åŠ›å¯¹ç­‰**ï¼šæ–°å¢ž graph-store.shï¼ˆSQLite å›¾å­˜å‚¨ï¼Œ4 ç§è¾¹ç±»åž‹ CRUDï¼‰ã€scip-to-graph.shï¼ˆSCIP ç´¢å¼•è§£æžè½¬æ¢ï¼‰ã€daemon.shï¼ˆå¸¸é©»å®ˆæŠ¤è¿›ç¨‹ï¼ŒUnix Socket é€šä¿¡ï¼‰ï¼›å¢žå¼º graph-rag.shï¼ˆLLM é‡æŽ’åºï¼‰ã€dependency-guard.shï¼ˆå­¤å„¿æ¨¡å—æ£€æµ‹ï¼‰ã€pattern-learner.shï¼ˆè‡ªåŠ¨æ¨¡å¼å‘çŽ°ï¼‰ã€common.shï¼ˆllm_call() é€‚é…å‡½æ•°ï¼‰ï¼›æ–°å¢ž MCP å·¥å…· ci_graph_storeï¼›æ–°å¢ž config/features.yaml åŠŸèƒ½å¼€å…³é…ç½® |
dev-playbooks/specs/architecture/c4.md:509:| 2026-01-17 | *****augment-parity-final-gaps***** | *****è¡¥é½ Augment å¯¹ç­‰æœ€åŽå·®è·ï¼ˆ100% è½»èµ„äº§èƒ½åŠ›å¯¹ç­‰ï¼‰*****ï¼šæ–°å¢ž adr-parser.shï¼ˆADR è§£æžä¸Žå…³è”ï¼‰ã€.github/workflows/arch-check.ymlï¼ˆGitHub Action CI/CDï¼‰ã€.gitlab-ci.yml.templateï¼ˆGitLab CI æ¨¡æ¿ï¼‰ï¼›å¢žå¼º scip-to-graph.shï¼ˆè¾¹ç±»åž‹æ‰©å±•ï¼šIMPLEMENTS/EXTENDS/RETURNS_TYPE/ADR_RELATEDï¼‰ã€graph-store.shï¼ˆfind-path è·¯å¾„æŸ¥è¯¢ + migrate è¿ç§»å‘½ä»¤ï¼‰ã€intent-learner.shï¼ˆå¯¹è¯ä¸Šä¸‹æ–‡æŒä¹…åŒ– + ä¼šè¯ç®¡ç† + è¿žç»­æ€§åŠ æƒï¼‰ã€daemon.shï¼ˆé¢„çƒ­æœºåˆ¶ + è¯·æ±‚å–æ¶ˆåè®®ï¼‰ã€cache-manager.shï¼ˆå­å›¾ LRU ç¼“å­˜ï¼ŒSQLite æŒä¹…åŒ–ï¼Œè·¨è¿›ç¨‹å…±äº«ï¼‰ã€bug-locator.shï¼ˆå½±å“åˆ†æžèžåˆ --with-impactï¼‰ã€augment-context-global.shï¼ˆ5 å±‚ç»“æž„åŒ–è¾“å‡º + DevBooks é€‚é…ï¼‰ã€common.shï¼ˆdetect_devbooks() + load_devbooks_context()ï¼‰ |
dev-playbooks/specs/architecture/c4.md:510:| 2026-01-18 | ******upgrade-code-intelligence-capabilities****** | ******ä»£ç æ™ºèƒ½èƒ½åŠ›è½»èµ„äº§å‡çº§ï¼ˆ70% â†’ 85-90%ï¼‰******ï¼šæ–°å¢ž CKBClientManagerï¼ˆsrc/server.ts å†…ï¼ŒMCP Client SDK é›†æˆï¼Œå¥åº·æ£€æŸ¥ï¼Œé™çº§çŠ¶æ€ç®¡ç†ï¼‰ã€fusion_search()ï¼ˆscripts/embedding.shï¼Œå›¾+å‘é‡èžåˆæŸ¥è¯¢ï¼‰ï¼›å¢žå¼º scip-to-graph.shï¼ˆIMPLEMENTS/EXTENDS/RETURNS_TYPE è¾¹ç±»åž‹è§£æžï¼Œæ­£åˆ™é™çº§ï¼‰ã€graph-store.shï¼ˆSchema v3 è¿ç§»ï¼Œè‡ªåŠ¨å¤‡ä»½ä¸Žå›žæ»šï¼Œå¹¶å‘ä¿æŠ¤ï¼‰ã€graph-rag.shï¼ˆ--fusion-depth å‚æ•°ï¼ŒèžåˆæŸ¥è¯¢é›†æˆï¼‰ã€daemon.shï¼ˆè‡ªåŠ¨é¢„çƒ­ï¼Œå¼‚æ­¥æ‰§è¡Œï¼Œ30s è¶…æ—¶ï¼‰ï¼›æ–°å¢ž 4 ä¸ª CLI è§„æ ¼ï¼ˆmcp-output-format, graph-store-cli, graph-rag-cli, daemon-cliï¼‰ |
dev-playbooks/specs/graph-store-enhancement/spec.md:141:**When**: æ‰§è¡Œ `scip-to-graph.sh` è½¬æ¢
dev-playbooks/specs/graph-store-enhancement/spec.md:152:**When**: æ‰§è¡Œ `scip-to-graph.sh` è½¬æ¢
dev-playbooks/specs/graph-store-enhancement/spec.md:163:**When**: æ‰§è¡Œ `scip-to-graph.sh` è½¬æ¢
dev-playbooks/specs/graph-store-enhancement/spec.md:174:**When**: æ‰§è¡Œ `scip-to-graph.sh` è½¬æ¢
dev-playbooks/specs/graph-store-enhancement/spec.md:185:**When**: æ‰§è¡Œ `scip-to-graph.sh` è½¬æ¢
