# 基线指标测量报告

> **测量时间**: 2026-01-11
> **测量者**: Baseline Analyst
> **目的**: 为代码智能能力增强提案建立可对比的基线数据

---

## 1. Bug 定位准确率基线

### 1.1 测量方法

使用 `scripts/bug-locator.sh` 对已知符号进行定位测试。

### 1.2 当前能力

| 指标 | 当前值 | 说明 |
|------|--------|------|
| Top-1 命中率 | 0% | CKB MCP 不可用时无法定位 |
| Top-3 命中率 | 0% | 降级模式下返回空结果 |
| Top-5 命中率 | 0% | 依赖外部调用链工具 |
| 热点回退 | 可用 | 无候选时返回热点文件 |

### 1.3 测量结果

```bash
# 测试命令
./scripts/bug-locator.sh --error "handleToolCall undefined" --format json --top-n 5

# 结果
{
  "schema_version": "1.0",
  "candidates": []
}

# 耗时：0.101s
```

### 1.4 备注

- CKB MCP 不可用时，bug-locator.sh 返回空候选列表
- 需要实施 hotspot-analyzer.sh 后可提供热点回退

---

## 2. 上下文相关性基线

### 2.1 测量方法

使用 `ci_search` / `ci-search` 工具搜索代码，评估结果与查询的相关性。

### 2.2 当前能力

| 指标 | 当前值 | 说明 |
|------|--------|------|
| 语义搜索可用性 | 不可用 | Ollama/OpenAI 未配置 |
| 关键词命中率 | 67% (2/3) | 基础关键词搜索准确率 |
| 平均响应时间 | 1.5s | 关键词搜索模式 |

### 2.3 测试结果

| 测试查询 | 期望文件 | 实际结果 | 命中 |
|----------|----------|----------|------|
| "runScript" | server.ts | dist/server.js (6 matches) | ✅ |
| "embedding" | embedding.sh | embedding.sh (1 match) | ✅ |
| "call chain tracer" | call-chain.sh | 0 matches | ❌ |

### 2.4 搜索模式状态

```
[Embedding] Ollama 和 OpenAI 都不可用，降级到关键词搜索
[Embedding] 使用 provider: keyword
```

---

## 3. 检索召回率基线

### 3.1 测量方法

给定一组已知相关文件，测量检索工具能找回多少。

### 3.2 当前能力

| 指标 | 当前值 | 说明 |
|------|--------|------|
| 召回率 | 67% (2/3) | 关键词匹配受限于分词 |
| 精确率 | ~50% | 返回结果含 node_modules |
| F1 分数 | ~57% | (2×0.67×0.5)/(0.67+0.5) |

### 3.3 问题分析

- 多词查询（如 "call chain tracer"）分词处理不佳
- 返回结果包含 node_modules 中的匹配，降低精确率
- 无语义理解能力，同义词无法匹配

---

## 4. 系统性能基线

### 4.1 测量结果

| 指标 | 当前值 | 目标阈值 |
|------|--------|----------|
| TypeScript 编译耗时 | 0.7s | - |
| 关键词搜索耗时 | 1.5s | - |
| Bug 定位耗时 | 0.1s | - |
| SCIP 索引大小 | 46KB | - |
| 热点计算耗时（1000 文件） | N/A（待实现） | < 5s |
| 子图检索内存增量 | N/A（待实现） | < 200MB |
| 增量索引耗时（单文件） | N/A（待实现） | < 1s |

### 4.2 测量环境

```
OS: Darwin 24.4.0
Node.js: v22.x
TypeScript: 5.9.3
项目规模: 1 TypeScript 文件, 13 Shell 脚本 (5305 行)
总源文件数: 36 (.ts + .sh)
```

---

## 5. 测试覆盖率基线

### 5.1 当前状态

| 指标 | 当前值 |
|------|--------|
| 单元测试数量 | 0 |
| 集成测试数量 | 0 |
| 自动化测试覆盖率 | 0% |
| ShellCheck 可用 | 是 |

### 5.2 计划的测试

| 测试类型 | 目标文件 | 优先级 | 状态 |
|----------|----------|--------|------|
| 回归测试 | `bug-locator.sh` | P0 | 待创建 (M6) |
| 单元测试 | 新增 4 个脚本 | P1 | 待实现 |
| 集成测试 | MCP 工具 | P1 | 待实现 |
| 性能测试 | 热点算法、子图检索 | P2 | 待实现 |

---

## 6. 基线快照

| 类别 | 指标 | 基线值 | 目标值 | 改进幅度 |
|------|------|--------|--------|----------|
| 准确率 | Bug 定位 Top-5 | 0% | 20%+ | N/A（从零开始） |
| 相关性 | 搜索命中率 | 67% | 90%+ | +23% |
| 召回率 | 相关文件覆盖 | 67% | 85%+ | +18% |
| 精确率 | 结果相关性 | 50% | 75%+ | +25% |
| 性能 | 编译耗时 | 0.7s | < 1s | 已达标 |
| 测试 | 覆盖率 | 0% | > 60% | +60% |

---

## 7. 工具可用性状态

| 工具/服务 | 状态 | 备注 |
|-----------|------|------|
| SCIP 索引 | ✅ 可用 | 46KB, TypeScript |
| CKB MCP | ❌ 不可用 | 影响调用链分析 |
| Ollama | ❌ 不可用 | 影响语义搜索 |
| OpenAI | ❌ 不可用 | 影响语义搜索 |
| ripgrep | ✅ 可用 | 关键词搜索后端 |
| jq | ✅ 可用 | JSON 处理 |

---

## 8. 验证状态

| ID | 验证项 | 状态 |
|----|--------|------|
| V-M1 | 基线测量文档存在 | ✅ |
| V-M5 | Bug 定位 Top-5 命中率有具体数值 | ✅ (0%) |
| V-M5 | 搜索命中率有具体数值 | ✅ (67%) |
| V-M5 | 召回率有具体数值 | ✅ (67%) |
| V-M5 | 性能指标有具体数值 | ✅ (0.7s/1.5s/0.1s) |
