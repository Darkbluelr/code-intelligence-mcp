# 领域概念：Code Intelligence MCP Server

> 生成时间：2026-01-10
> 生成方式：传统分析

---

## 核心概念

### 1. MCP（Model Context Protocol）

**定义**：Anthropic 开发的开放协议，用于 AI 助手与外部工具/服务之间的标准化通信。

**在本项目中**：
- 本项目是一个 MCP Server
- 通过 stdio 传输与 Claude Code 通信
- 暴露 6 个工具供 AI 助手调用

**相关组件**：`src/server.ts`，`@modelcontextprotocol/sdk`

---

### 2. Embedding（嵌入向量）

**定义**：将代码片段转换为高维向量的过程，用于语义搜索。

**在本项目中**：
- 支持本地（Ollama）和云端（OpenAI）Embedding
- 用于 `ci_search` 工具的语义搜索模式
- 索引存储在项目 `.ci-cache/` 目录

**相关组件**：`scripts/embedding.sh`，`scripts/indexer.sh`

---

### 3. Graph-RAG（图检索增强生成）

**定义**：结合图结构和向量检索的上下文获取策略。

**在本项目中**：
- 利用 CKB MCP Server 的图遍历能力
- 结合 Embedding 搜索结果
- 返回相关代码上下文给 AI 助手

**相关组件**：`scripts/graph-rag.sh`

---

### 4. Call Chain（调用链）

**定义**：函数之间的调用关系路径。

**在本项目中**：
- 支持 callers（谁调用了我）
- 支持 callees（我调用了谁）
- 支持双向追踪（both）
- 可配置追踪深度

**相关组件**：`scripts/call-chain.sh`

---

### 5. Thin Shell（薄壳架构）

**定义**：服务器仅作为协议适配层，核心逻辑在外部脚本中实现。

**在本项目中**：
- `server.ts` 仅处理 MCP 协议和工具调度
- 实际功能由 `scripts/*.sh` 实现
- 设计约束：`CON-TECH-002`

**优势**：
- 脚本可独立测试和使用
- 降低 TypeScript 复杂度
- 便于功能扩展

---

### 6. Context Injection（上下文注入）

**定义**：在用户提问前自动注入相关代码上下文。

**在本项目中**：
- 通过 Claude Code 钩子实现
- 自动搜索相关代码片段
- 检测热点文件并提示

**相关组件**：`hooks/augment-context-global.sh`

---

### 7. Hotspot（热点文件）

**定义**：变更频率高且复杂度高的文件，通常是 Bug 密集区。

**计算公式**：
```
热点分数 = 变更频率 × 圈复杂度
```

**在本项目中**：
- 用于 Bug 定位
- 用于上下文注入优先级

---

### 8. CKB（Code Knowledge Base）

**定义**：代码知识库 MCP Server，提供图基代码分析能力。

**提供的能力**：
- 符号搜索
- 引用查找
- 调用图
- 架构概览
- 影响分析

**在本项目中**：作为可选外部依赖

---

## 概念关系图

```
┌─────────────────────────────────────────────────────────────┐
│                     Claude Code (Client)                     │
└─────────────────────────────────────────────────────────────┘
                               │
                    MCP Protocol + Context Injection
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                     code-intelligence-mcp                    │
│                       (Thin Shell)                           │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                  Tool Registry                        │   │
│  │                                                       │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐              │   │
│  │  │ci_search│  │ci_call_ │  │ci_bug_  │              │   │
│  │  │         │  │ chain   │  │ locate  │              │   │
│  │  │Embedding│  │Call Chain│ │ Hotspot │              │   │
│  │  └─────────┘  └─────────┘  └─────────┘              │   │
│  │                                                       │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐              │   │
│  │  │ci_compl-│  │ci_graph_│  │ci_index_│              │   │
│  │  │  exity  │  │   rag   │  │ status  │              │   │
│  │  │         │  │Graph-RAG│  │         │              │   │
│  │  └─────────┘  └─────────┘  └─────────┘              │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                    External Services                         │
│                                                              │
│    ┌─────────┐     ┌─────────┐     ┌─────────┐             │
│    │ Ollama/ │     │   CKB   │     │ ripgrep │             │
│    │ OpenAI  │     │   MCP   │     │   jq    │             │
│    │Embedding│     │  Server │     │  tools  │             │
│    └─────────┘     └─────────┘     └─────────┘             │
└─────────────────────────────────────────────────────────────┘
```

---

## 术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 薄壳 | Thin Shell | 仅做协议适配，核心逻辑外置 |
| 嵌入 | Embedding | 代码到向量的转换 |
| 图检索增强生成 | Graph-RAG | 图+向量的混合检索 |
| 调用链 | Call Chain | 函数调用关系路径 |
| 热点 | Hotspot | 高频变更+高复杂度文件 |
| 上下文注入 | Context Injection | 自动提供相关代码上下文 |
| 代码知识库 | CKB | 图基代码分析服务 |
